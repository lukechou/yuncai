require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",store:"../lib/store.min",bootstrap:"../lib/bootstrap.min",app:"../common/app",tipsy:"../lib/jquery.tipsy"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"},tipsy:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","store","app","bootstrap","tipsy"],function(t,e,a,n){"use strict";function s(e,a){e.val(a);for(var s=0;s<W.curInput.length;s++){var r=W.curInput.eq(s).val();if(s>0){var i=W.curInput.eq(s-1).val(),o=parseInt(100*(r/i-1),10);if(o>k||_>o)return n.showTips("在投注金额范围内，需满足投注增加比例的范围"+_+"%-"+k+"%"),e.val(e.data("val")),!1}}e.data("val",a);for(var s=0;s<W.curInput.length;s++){var l=W.curInput.eq(s).val();if(x>l?(n.showTips("投注金额范围为"+x+"-"+I+"元"),l=x):l>I&&(n.showTips("投注金额范围为"+x+"-"+I+"元"),l=I),W.curInput.eq(s).text(l),W.curInput.eq(s).val(l),W.curMoneyObj.eq(s).html(l),s>0){var u=W.curInput.eq(s-1).val(),d=parseInt(100*(l/u-1),10);W.numObj.eq(s).val(d).data("val",d)}var p=W.numObj.eq(s).val();W.viewObj.eq(s).text(p+"%");var c=parseInt(l);if(s>0){var v=parseInt(W.addMoneyObj.eq(s-1).text(),10);W.addMoneyObj.eq(s).text(parseInt(c)+v),t("#j-count-total").text(parseInt(c)+v),D=parseInt(c)+v}else W.addMoneyObj.eq(s).text(c);{W.addMoneyObj.eq(s).text()}W.bountyMoneyObj.eq(s).text((parseInt(l)*ar).toFixed(2))}}function r(t){var e=t.val();if(x>e)return n.showTips("投注金额范围为"+x+"-"+I+"元"),void t.val(x);if(e>I)return n.showTips("投注金额范围为"+x+"-"+I+"元"),void t.val(I);if(!U.test(e))return n.showTips("请输入整数"),void t.val(t.data("val"));for(var a=0;a<W.curInput.length;a++){var s=W.curInput.eq(a).val();if(a>0){var r=W.curInput.eq(a-1).val(),i=parseInt(100*(s/r-1),10);if(i>k||_>i)return n.showTips("在投注金额范围内，需满足投注增加比例的范围"+_+"%-"+k+"%"),t.val(t.data("val")),!1}}}function i(){t(".j-icon-tips").tipsy({gravity:"s",opacity:1}),t("#j-first,#j-space,#j-rate").tipsy({trigger:"focus",gravity:"s",opacity:1}),t('[name="autotype"]').on("change",function(e){e.preventDefault();var a=t(this).val(),n=t("#j-issue"),s=4;S=~~a,n.trigger("keyup").trigger("focus"),s=1===S?4:5,H=S,J=!S,t("#j-percent-edit-wrap").addClass("hide"),E.html('<tr><td colspan="'+s+'" class="empty-tip">请填写参数并执行投注分配</td></tr>'),W.changedfrom=!1}),$.focus(function(){t("#j-money-issue-tip").html(1==S?1==L?'（<span class="fc-3">范围：'+F+"期</span>）":'（<span class="fc-3">范围：'+F+"-"+L+"期</span>）":R)}),$.keyup(function(){if(1===S){var e=t(this).val();Q=0;for(var a=0;a<moneyArr.length;a++)moneyArr[a][0]==e&&(Q=moneyArr[a][1]);if(Q){if(Q>=1e3){var n=Q+"";n=n.replace(/(\d\d\d)$/,",$1")}else n=Q;t("#j-money-total-tip").removeClass("hide").html('（<span class="fc-3">范围：'+n+"-500,000 元</span>）"),t(".j-total").val(Q)}else t("#j-money-total-tip").addClass("hide")}else t("#j-money-total-tip").addClass("hide")})}function o(){t("#j-count-result").removeClass("hide"),t("#j-count-total").text(W.addVal),t("#j-count-issue").text(W.issueVal)}function l(t){var e="";for(var a in t)t.hasOwnProperty(a)&&(e+="<tr>",e+='<td class="w200">'+a+'<input type="hidden" name="issue_num[]" value="'+a+'"></td>',e+='<td><span class="j-view">'+t[a].bet_money+"</span>",e+='<span class="j-edit edit-wrap clearfix hide">',e+='<a href="javascript:;" class="i-reduce j-reduce">-</a>',e+='<input class="j-num edit-num" data-val="'+t[a].bet_money+'" type="text" name="current_money[]" value="'+t[a].bet_money+'">',e+='<a href="javascript:;" class="i-add j-add">+</a>',e+="</span></td>",e+='<td class="w200"><span class="j-add-money">'+t[a].add_money+"</span></td>",e+='<td class="w200"><span class="j-bounty-money">'+t[a].bounty_money+"</span></td>",e+="</tr>");return e}function u(){1<W.issueVal?t("#j-percent-edit-wrap").removeClass("hide"):t("#j-percent-edit-wrap").addClass("hide")}function d(){var e=~~S,a=["#j-percent-thead","#j-money-thead"],n=~~!e;t(a[e]).removeClass("hide"),t(a[n]).addClass("hide")}function p(a){return~~e.escape(t.trim(a))}function c(){var t="",e=W.issueVal,a=W.rateVal,n=W.firstVal,s=W.curVal,r=W.spaceVal,i=parseInt(a,10),o=0,l=1;r+=1;for(var u=0;e>u;u++)0!=u&&u%r==0||0!=u&&0==r?(i=parseInt(a,10),l*=i/100+1):i=0,s=Math.round(n*l),s%2!=0&&s++,W.addVal+=s,o=parseFloat(s*ar).toFixed(2),t+="<tr>",t+='<td class="w80">'+(u+1)+'<input type="hidden" name="issue_num[]" value="'+(u+1)+'"></td>',0==u?(t+='<td class="w1"><span class="j-view j-rate-view">'+i+'%</span><span class="j-edit hide">'+i+"%</span>",t+='<input maxLength="6" class="j-num edit-num" type="hidden" name="current_rate[]" value="'+i+'">',t+="</td>"):(t+='<td class="w1"><span class="j-view j-rate-view">'+i+"%</span>",t+='<span class="edit-wrap-w j-edit hide clearfix"><span class="edit-wrap clearfix">',t+='<a href="javascript:;" class="i-reduce j-reduce">-</a>',t+='<input maxLength="6" data-val="'+i+'" class="j-num edit-num"  title="范围为 -100%-1000%"  type="text" name="current_rate[]" value="'+i+'">',t+='<a href="javascript:;" class="i-add j-add">+</a>',t+="</span>%</span></td>"),t+='<td class="w1"><span class="j-view j-cur-money">'+s+"</span>",t+='<span class="edit-wrap-w j-edit hide clearfix"><span class="edit-wrap clearfix">',t+='<a href="javascript:;" class="i-reduce j-reduce-m">-</a>',t+='<input data-val="'+s+'" class="j-cur-input edit-num" title="范围为 30-500000 元" type="text" name="current_money[]" value="'+s+'">',t+='<a href="javascript:;" class="i-add j-add-m">+</a>',t+="</span></span></td>",t+='<td class="w200"><span class="j-add-money">'+W.addVal+"</span></td>",t+='<td class="w200"><span class="j-bounty-money">'+o+"</span></td>",t+="</tr>";return t}function v(){var e=p(t("#j-issue").val()),a=p(t("#j-total").val());return F>e||e>L||K.test(e)||""==e?(n.showTips("期数不能小于"+F+"或大于"+L),!1):Q>a||a>I||K.test(a)||""==a||a%2!=0?(n.showTips("投注总额不能小于"+Q+"或大于"+I+"偶数整数"),!1):!0}function m(){var t=$.val(),e=(z.val(),N.val()),a=parseInt(B.val(),10),s=P.val();return""===t||M>t||t>V||K.test(t)?(n.showTips("期数不得小于1或大于50的整数"),!1):""===e||x>e||e>I||K.test(e)||e%2!=0?(n.showTips("每期的首期投注范围为30-500000的偶数，请重新设置"),!1):g>a||a>O||K.test(a)||""===a?(n.showTips("每期的间隔期数范围为0-10，请重新设置"),!1):K.test(s)||_>s||s>k||""===s?(n.showTips("每期的增加比例范围为0%-1000%，请重新设置"),!1):!0}function j(t){E.html(t),h()}function f(){W.addVal=W.totalVal,t.ajax({url:"/lottery/model/autobuy/analyse-fixed-profit/ajx",type:"get",dataType:"json",data:{t:t.now(),total_issue:W.issueVal,model_id:C,total_money:W.totalVal}}).done(function(t){if(1e5===t.retCode){var e="";if(e=l(t.retData),!e)return;return d(),j(e),A=W.totalVal,void o()}return void n.showTips(t.retMsg)})}function h(){W.viewObj=E.find(".j-rate-view"),W.numObj=E.find(".j-num"),W.curMoneyObj=E.find(".j-cur-money"),W.curInput=E.find(".j-cur-input"),W.addMoneyBtn=E.find(".j-add-m"),W.reduceMoneyBtn=E.find(".j-reduce-m"),W.addMoneyObj=E.find(".j-add-money"),W.bountyMoneyObj=E.find(".j-bounty-money"),W.addObj=E.find(".j-add"),W.reduceObj=E.find(".j-reduce"),W.preVal=0,W.timer=null,W.mTimer=null,S&&(W.viewObj=E.find(".j-view"))}function y(){W.issueVal=p(t("#j-issue").val()),W.firstVal=p(t("#j-first").val()),W.spaceVal=p(t("#j-space").val()),W.rateVal=p(t("#j-rate").val()),W.totalVal=p(S?t("#j-total").val():t("#j-count-total").html())}function b(){var e=t("#j-data-body").html(),a="",n='您对模型<span class="mlr5">'+C+"</span> 设置了"+W.issueVal+'期的自动投注 总投注金额为<span class="mlr5 fc-3">'+W.totalVal+'</span>元（<span class="fc-84">系统会按期自动投注</span>）',s="";s=p(t('[name="autostop"]:checked').val())?"完成所有期数后终止":"盈利以后自动终止",a=S?'<tr><th class="w200">期数</th><th>当期投注金额(元)</th><th class="w200">累计投注金额(元)</th><th class="w200">当前预计奖金(元)</th></tr>':"<tr><th>期数</th><th>投注增加比例</th><th>当期投注金额(元)</th><th>累计投注金额(元)</th><th>当前预计奖金(元)</th></tr>",t("#j-modal-title").html(n),t("#j-modal-thead").html(a),t("#j-modal-tbody").html(e),t("#j-moal-stop").html(s),t("#autoModal").modal("show")}function w(e){var a=null;a=S?Number(t("#j-data-body .j-num").eq(0).val()):W.firstVal;var s='<p>当前账户余额不足支付自动投注的首期金额</p><p>首期投注金额：<span class="fc-3">'+a+".00</span>元</p>";n.checkLogin(a,{enoughMoney:function(a){t.ajax({url:"/lottery/model/autobuy/buy",type:"post",dataType:"json",data:e}).done(function(t){1e5===t.retCode?window.location.href="/lottery/model/autobuy/auto-buy-detail?model_id="+C:n.showTips(t.retMsg)})},lessMoneyTips:s})}function T(e,a){var s=W.numObj.index(e),r=a/100+1,i=null;if(U.test(a)||(n.showTips("投注增加比例必须为整数"),a=0),0==s)var o=Math.round(r*W.curMoneyObj.eq(s).text());else var o=Math.round(r*W.curMoneyObj.eq(s-1).text());o%2!=0&&o++;for(var l=0;l<W.viewObj.length;l++){var u=0,d=0;if(l==s)var p=a;else var p=W.numObj.eq(l).val();var c=U.test(p);c||(p=0,$numObj.eq(l).val(0));var r=p/100+1;if(0==l)var o=Math.round(r*W.curMoneyObj.eq(l).text());else var o=Math.round(r*o);o%2!=0&&o++,_>p?(p=_,u=1):p>k&&(p=k,u=1),1==u&&l>0&&(n.showTips("投注增加比例范围为-99%-1000%"),i=p/100+1,o=Math.round(i*v),o%2!=0&&o++),x>o?(o=x,d=1):o>I&&(o=I,d=1),1==d&&l>0&&(n.showTips("在投注增加比例范围内，需满足投注金额的范围30-500000元"),p=Math.ceil(100*(o-v)/v));var v=o;if(W.viewObj.eq(l).text(p+"%"),W.numObj.eq(l).text(p),W.numObj.eq(l).val(p),W.curMoneyObj.eq(l).text(o),W.curInput.eq(l).val(o).data("val",o),l>0){var m=parseInt(W.addMoneyObj.eq(l-1).text(),10);W.addMoneyObj.eq(l).text(parseInt(o)+m),t("#j-count-total").text(parseInt(o)+m),D=parseInt(o)+m}else W.addMoneyObj.eq(l).text(o);{W.addMoneyObj.eq(l).text()}W.bountyMoneyObj.eq(l).text((parseInt(o)*ar).toFixed(2))}}function q(e,a){var a=a||0;if(30>a)return n.showTips("当期投注金额最低为30元"),void(e.data("val")&&e.val(e.data("val")));if(a>5e5)return n.showTips("当期投注金额最高为500,000元"),void(e.data("val")&&e.val(e.data("val")));e.data("val",a),e.val(a);for(var s=0;s<W.viewObj.length;s++){var r=parseInt(W.numObj.eq(s).val(),10);if(W.viewObj.eq(s).text(r),s>0){var i=parseInt(W.addMoneyObj.eq(s-1).text(),10);W.addMoneyObj.eq(s).text(r+i),A=r+i,t("#j-count-total").text(r+i),t("#j-total").val(r+i)}else W.addMoneyObj.eq(s).text(r);W.bountyMoneyObj.eq(s).text((parseInt(r)*ar).toFixed(2))}}var x=30,I=5e5,g=0,O=10,M=1,V=50,_=-100,k=1e3,C=t("#j-module-id").val(),D=0,A=0,F=moneyArr[0][0],L=moneyArr[moneyArr.length-1][0],$=t("#j-issue"),N=t("#j-first"),B=t("#j-space"),P=t("#j-rate"),z=t("#j-total"),E=t("#j-data-body"),G=t("#j-modify"),H=!1,J=!1,K=/\D/,Q=0,R='(<span class="fc-3">范围：1-50期</span>)',S=0,U=/^-?[0-9]{1,}$/,W={changedfrom:!1};E.on("click",".j-add",function(e){e.preventDefault();var a=t(this).siblings(".j-num"),s=parseInt(a.val());return!S&&(s++,_>s||s>k)?void n.showTips("投注增加比例范围为"+_+"%-"+k+"%"):(W.timer&&clearTimeout(W.timer),void(W.timer=setTimeout(function(){S?(s+=2,q(a,s)):T(a,s)},100)))}),E.on("click",".j-reduce",function(e){e.preventDefault();var a=t(this).siblings(".j-num"),s=parseInt(a.val());return!S&&(s--,_>s||s>k)?void n.showTips("投注增加比例范围为"+_+"%-"+k+"%"):(W.timer&&clearTimeout(W.timer),void(W.timer=setTimeout(function(){S?(s-=2,q(a,s)):T(a,s)},100)))}),E.on("keyup",".j-num",function(e){e.preventDefault();var a=t(this),n=parseInt(a.val(),10);"-"!=a.val()&&(n==-0&&(a.val(0),n=0),isNaN(n)&&(t(this).val(t(this).val().replace(/[^0-9.-]/g,"")),n=a.val()),W.timer&&clearTimeout(W.timer),W.timer=setTimeout(function(){S?q(a,n):T(a,n)},200))}),E.on("blur",".j-num",function(e){if(e.preventDefault(),0===S){var a=t(this),s=a.val();if(_>s||s>k||!U.test(s))return n.showTips("投注增加比例范围为"+_+"%-"+k+"%"),void a.val(a.data("val"))}}),E.on("click",".j-add-m",function(e){e.preventDefault();var a=t(this).siblings(".j-cur-input"),r=parseInt(a.val())+2;return x>r?void n.showTips("投注金额范围为"+x+"-"+I+"元"):r>I?void n.showTips("投注金额范围为"+x+"-"+I+"元"):(W.mTimer&&clearTimeout(W.mTimer),void(W.mTimer=setTimeout(function(){s(a,r)},100)))}),E.on("click",".j-reduce-m",function(e){e.preventDefault();var a=t(this).siblings(".j-cur-input"),r=parseInt(a.val())-2;return x>r?void n.showTips("投注金额范围为"+x+"-"+I+"元"):r>I?void n.showTips("投注金额范围为"+x+"-"+I+"元"):(W.mTimer&&clearTimeout(W.mTimer),void(W.mTimer=setTimeout(function(){s(a,r)},100)))}),E.on("keyup",".j-cur-input",function(e){e.preventDefault();var a=t(this),n=a.val();if(t(this).val(t(this).val().replace(/[^0-9]/g,"")),!(x>n)&&U.test(n)){a.val(n);for(var i=0;i<W.curInput.length;i++){var o=W.curInput.eq(i).val();if(i>0){var l=W.curInput.eq(i-1).val(),u=parseInt(100*(o/l-1),10);if(u>1e3||-100>u)return!1}}n%2!=0&&n++,W.mTimer&&clearTimeout(W.mTimer),W.mTimer=setTimeout(function(){s(a,n)},100),n>30&&r(a)}}),E.on("blur",".j-cur-input",function(e){e.preventDefault(),t(this).val(t(this).val().replace(/[^0-9]/g,""));var a=t(this);r(a)}),i(),t("#j-auto-buy").on("click",function(e){e.preventDefault();var a="";a=p(t('[name="autostop"]:checked').val())?"完成所有期数后终止":"盈利以后自动终止";var n={total_issue:W.issueVal,model_id:C,total_money:W.totalVal,stop_type:p(t('[name="autostop"]:checked').val()),first_money:W.firstVal,space_issue:W.spaceVal,space_rate:W.rateVal,auto_type:S};t("#j-data-body").find("input[name]").each(function(){var e=t(this).attr("name")+"";0!==e.length&&(n[e]||(n[e]=[]),n[e].push(t(this).val()))}),t("#autoModal").modal("hide"),w(n)}),t(".j-inp-num").on("keyup paste",function(e){e.preventDefault(),t(this).val(t(this).val().replace(/[^0-9]/g,""))}),t("#j-count-confirm").on("click",function(e){return e.preventDefault(),W.changedfrom?void n.checkLogin(null,{always:function(){if(y(),0===S){if(W.status=m(),!W.status)return;for(var e=t(".j-view"),a=0;a<e.length;a++){var s=e.eq(a).text();if(x>s||s>I)return n.showTips("当期投注不能小于30或大于500000"),!1}t(".j-edit").addClass("hide"),t(".j-view").removeClass("hide"),b()}if(1===S){if(W.status=v(),!W.status)return;for(var e=t(".j-cur-money"),a=0;a<e.length;a++){var s=e.eq(a).text();if(x>s||s>I)return n.showTips("当期投注不能小于30或大于500000"),!1}t(".j-edit").addClass("hide"),t(".j-view").removeClass("hide"),b()}}},!0):(n.showTips("请先点击计算自动投注分配！"),!1)}),G.on("click",function(e){e.preventDefault(),t(".j-edit").removeClass("hide"),t(".j-view").addClass("hide")}),t("#j-count").on("click",function(t){t.preventDefault(),W.changedfrom=!0,y();var e="";if(0!==S)return 1===S?(H=!0,W.status=v(),void(W.status&&(u(),f()))):void 0;if(J=!0,W.status=m(),W.status){if(u(),d(),W.curVal=parseInt(W.firstVal,10),W.addVal=0,W.curVal>I)return n.showTips("当期投注金额不能大于"+I),!1;D=W.addVal,e=c(),j(e),o()}})});