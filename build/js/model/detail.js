require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",store:"../lib/store.min",bootstrap:"../lib/bootstrap.min",app:"../common/app",model:"model",chart:"chart",highcharts:"highcharts",tipsy:"../lib/jquery.tipsy"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"},tipsy:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","store","chart","app","model","bootstrap","tipsy"],function(t,e,a,o,n,i){"use strict";function s(){n.bindInputPlace(),n.bindInputOnlyInt(".j-only-int"),i.init({modal:t("#collect"),starList:t(".td-star-level a"),starLevel:null,modelId:null,starComment:"",modelComment:""}),i.bindCollectEvent(),o.init({chartEl:t("#chart")}),o.getChartData(c),r()}function r(){t.ajax({url:"/lottery/model/autobuy/auto-buy-list",type:"get",dataType:"json",data:{model_id:c}}).done(function(a){if(1e5===a.retCode){var o="",i=a.retData.data,s=i.length,r=e.filter(i,function(t){return"0"===t.auto_status}).length;t("#j-auto-count").html(s),t("#j-auto-go").html(r),s>0?o=e.map(i,function(t,e){var a=['<td class="fc-7">进行中</td>','<td class="fc-3">已结束</td>','<td class="fc-3">已结束</td>','<td class="fc-3">已结束</td>','<td class="fc-3">已结束</td>','<td class="fc-3">已结束</td>'],o="<tr><td>"+(e+1)+"</td><td>"+n.dateFormat(new Date(1e3*t.start_time),"%Y-%M-%d %h:%m:%s",!0)+"</td><td>"+t.complete_issue+"/"+t.total_issue+"</td><td>"+t.project_money+"</td><td>"+t.total_bounty+"</td>"+a[t.auto_status]+'<td><a href="/lottery/model/autobuy/auto-buy-detail?model_id='+c+"&rid="+t.id+'" target="_blank">查看</a></td>';return o+="<td></td></tr>"}).join(""):(t("#j-lookmore-link").hide(),o+='<tr><td colspan="8">该模型您没有设置自动投注</td></tr>'),t("#j-auto-list").html(o),t("#j-main-auto").show(),t(".j-icon-tips").tipsy({gravity:"nw",html:!0,opacity:1})}})}function l(){var t=Number(p.val());if(t%2==0&&t>=h&&f>=t&&!/\D|^0/.test(t)){for(var e=0;e<y.length;e++)y[e]=1;for(var a=t/2,o=0;o<a-y.length;o++){for(var n=0,i=v[0]*(0==y[0]?1:y[0]),s=0;s<v.length;s++){var r=v[s]*(0==y[s]?1:y[s]);i>r&&(i=r,n=s)}y[n]=parseInt(y[n])+1}for(var l=(y[0]*v[0]*2).toFixed(2),d=0;d<y.length;d++){var u=(y[d]*v[d]*2).toFixed(2);l=u>l?l:u}m.html(l)}else m.html("--")}function d(t){var e="";return e='<div class="m-detail-box"><p>您对模型编号<span class="mlr-8 fc-3">'+t.model_id+'</span>投注<span class="mlr-8 fc-3">'+t.money+'</span>元，请确认</p><div class="btns"><button class="btn btn-danger" id="buyConfirm">确定</button><button class="btn btn-gray" data-dismiss="modal">取消</button></div></div>'}function u(){var e=t.now(),a=new Date(1e3*t("#j-stop-time").val()).getTime(),o=(a-e)/1e3,n="",i="",s="",r="",l="";o>0?(i=Math.floor(o/60/60/24),s=Math.floor(o/60/60)%24,r=Math.floor(o/60%60),l=Math.floor(o%60),n='本模型离当前投注截止还剩<span id="j-day">'+i+'</span>天<span id="j-hour">'+s+'</span>小时<span id="j-minute">'+r+'</span>分<span id="j-second">'+l+"</span>秒"):(n="本模型当期已截止投注",t("#j-stop-td").html("已截止"),clearInterval(k),t("#j-ft-main").hide(),t("#j-stop-box").removeClass("hide")),t("#j-time-tip").html(n)}var c=e.escape(t.trim(t("#j-module-id").val()));s();var p=t("#j-money"),m=t("#j-prize"),h=Number(t("#j-minBuy").val()),f=5e5,v=[],y=[],b=null,j=null,g=[],_=[],C=[];t("#track_detail_list tr").each(function(e,a){var o=[],n=0;t(this).find(".j-pei").each(function(e,a){n=Number(t(this).text()),o.push(n)}),g.push(o)}),t("#track_detail_list .j-text").each(function(e,a){var o=[];t(this).find("span").each(function(e,a){var n="";"胜"===t(this).text()&&(n=0),"平"===t(this).text()&&(n=1),"负"===t(this).text()&&(n=2),o.push(n)}),_.push(o)});for(var x=_[0].length-1;x>=0;x--)C.push((g[0][_[0][x]]*g[1][_[1][x]]).toFixed(2));for(var x=C.length-1;x>=0;x--)v.push(C[x]),y.push(0);p.keyup(function(){j&&clearTimeout(j),b=setTimeout(l,300)});var w=p.val();p.focus(function(){w==p.val()&&p.val("").removeClass("gray")}),p.blur(function(){""==p.val()&&p.val(w).addClass("gray")}),t("#j-buy").on("click",function(a){a.preventDefault(),window.Config={};var o=Number(t("#j-money").val()),i={project_issue:e.escape(t.trim(t("#j-issue").val())),model_id:e.escape(t.trim(t("#j-module-id").val())),money:o},s=d(i);if(h>o)return void n.showTips("亲,投注金额不能低于 "+h+" 元");if(o%2!==0)return void n.showTips("请输入偶数的金额");if(o>f)return void n.showTips("亲,单次投注金额最大限制为 500000 元");Config.payMoney=o;var r="";r+="<p>模型"+i.model_id+"</p>",r+='<p>本次需支付：<span class="fc-3 mlr5">'+o+".00</span>元</p>",n.checkLogin(o,{enoughMoney:function(){n.showTips({title:"投注确认",html:s,callback:function(){t("#buyConfirm").unbind("click"),t("#buyConfirm").on("click",function(e){e.preventDefault(),t.ajax({url:"/lottery/trade/model-fast-buy",type:"post",dataType:"json",data:i}).done(function(t){1e5===t.retCode?n.showTips({type:1,text:"购买成功",onConfirm:function(){window.location.reload()}}):n.handRetCode(t.retCode,t.retMsg)}).fail(function(){n.onServiceFail()})})}})},lessMoneyTips:r})});var k=setInterval(function(){u()},1e3)});