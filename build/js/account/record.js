$(function(){"use strict";function t(t,a){var e=t.retData.data.length,o=t.retData.data,r="",d="",i="",s="",l="",c="";if(e>0){for(var p=0;p<o.length;p++)switch(l=o[p],c="",i='<a  target="_blank" class="ml8" href="'+l.buyURI+'">继续投注</a>',"模型"==l.lotyCNName?(l.lotyCNName='<i class="icon-font icon-f8" title="模型：'+l.projectNo+'">模</i>',l.lotyCNName+="竞彩足球",3==a?(d='<a href="javascript:;" class="j-history-more" data-order="'+l.order_no+'">查看</a>',i=""):d='<a  target="_blank" href="'+l.detailURI+'">查看详情</a>'):d='<a  target="_blank" href="'+l.detailURI+'">查看详情</a>',0==l.show&&(i="",d=""),0==l.bonus?c=l.status:(c='中奖 <span style="color:red">'+l.bonus+"</span>元","0.00"!=l.tcbonus&&(c+="+["+l.tcbonus+'元<i class="icon icon-warm ps-t2 j-tips" original-title="发起人提成['+l.tcbonus+']元"></i>]')),a){case 3:s=Number(l.bonusMoney)>0?"fc-3":"",r+="<tr><td>"+n(l.gou,l.lian,l.xiao,l.yan,l.hasAutoBuy)+"</td>",r+="<td>"+l.createTime+"</td>",r+="<td>"+l.qihao+"</td>",r+='<td><a href="'+l.buyURI+'">'+l.projectNo+"</a></td><td>"+l.money+"</td>",r+='<td class="'+s+'">'+c+"</td>",r+="<td>"+d+i+"</td></tr>";break;case 0:r+="<tr><td>"+l.lotyCNName+"</td><td>"+l.createTime+"</td><td>"+l.money+"</td><td>"+c+"</td><td>"+d+i+"</td></tr>";break;default:r+="<tr><td>"+l.lotyCNName+"</td><td>"+l.createTime+"</td><td>"+l.money+"</td><td>"+c+"</td><td>"+d+i+"</td></tr>"}"1"==a&&($("#summary_bonus_sum").html(t.retData.summary.bonusSum),$("#summary_bonus_size").html(t.retData.summary.bonusSize))}else r="<tr><td colspan='6'>没有数据</td></tr>";return r}function a(t){for(var a="",e=t.length-1;e>=0;e--)t[e]="<span>"+t[e]+"</span>";return a=t.join("")}function e(t,a){for(var e="",n=a.join(),o=t.length-1;o>=0;o--)t[o]=t[o].join()==n?'<span class="fc-3">'+t[o]+"</span>":"<span>"+t[o]+"</span>";return e=t.join("")}function n(t,a,e,n,o){var r=[];return t&&r.push('<i class="icon icon-m3" title="您当期已投注该模型"></i>'),a&&r.push('<i class="icon-font icon-f1" title="您上一期已投注该模型（上一期是指该模型有比赛内容的期次）">连</i>'),e&&r.push('<i class="icon-font icon-f7" title="有比赛取消">消</i>'),n&&r.push('<i class="icon-font icon-f6" title="有比赛延期">延</i>'),o&&r.push('<i class="icon-font icon-f3" title="您设置自动投注已投注该模型">自</i>'),r.join("")}function o(t){$.ajax({url:"/lottery/trade/view-detail",type:"get",dataType:"json",data:{order_no:t}}).done(function(n){if(1e5==n.retCode){var o=n.retData[0],r='<td colspan="7"><div class="look-box"><table class="table m-mn-table m-table-border m-table-middle"><thead><tr><th>赛事编号</th><th>对阵</th><th>赛果</th><th>投注内容</th><th>投注注数</th><th>投注金额（元）</th><th>奖金（元）</th></tr></thead><tbody><tr>';r+="<td>"+a(o.ssbh)+"</td>",r+="<td>"+a(o.dz)+"</td>",r+='<td class="fc-3">'+o.sg+"</td>",r+="<td>"+e(o.tzNr,o.sg)+"</td>",r+="<td>"+a(o.tzZs)+"</td>",r+="<td>"+a(o.tzJe)+"</td>",r+='<td class="fc-3">'+o.bonus+"</td>",r+="</tr></tbody></table></div></td>",$(".j-look[data-no="+t+"]").html(r)}else APP.handRetCode(n.retCode,n.retMsg)}).fail(function(){APP.onServiceFail()})}PAGE.loadOrderRecord=function(a){PAGE.ajaxUrl=window.location.pathname+"/ajax",PAGE.pageElement=$(".j-page-box"),PAGE.initAjax(a),PAGE.onSuccess=function(e){var n="";1e5==e.retCode?(n=t(e,a.type),PAGE.config.pageNum=Math.ceil(e.retData.totalRecord/a.pageSize),PAGE.makePageHtml(),PAGE.bindPageEvent(PAGE.loadOrderRecord)):n="<tr><td colspan='6'>"+e.retMsg+"</td></tr>",this.appendTable(n),d.type=a.type,$(".j-tips").tipsy({gravity:"s",html:!0,opacity:1})},PAGE.onFail=function(){}};var r=$(".tab-content .table"),d=function(){var t={page:1,pageSize:15,type:null,init:function(){var t=0;""!=APP.getUrlPara("type")&&(t=Number(APP.getUrlPara("type")),isNaN(t)&&(t=0),0>t&&(t=0),t>=r.length&&(t=0)),this.type=t,$("#nav-tabs li:eq("+t+") a").tab("show"),PAGE.pageTable=r.eq(t).find("tbody"),PAGE.loadOrderRecord({type:t,days:30,page:1,pageSize:15})}};return t}();$(".nearday").on("change",function(){var t=parseInt($(this).parents(".tab-pane").index()),a=$(this).val()||30;PAGE.pageTable=r.eq(t).find("tbody"),PAGE.loadOrderRecord({type:t,days:a,page:1,pageSize:15})}),$("#nav-tabs").on("click"," a",function(){var t=parseInt($(this).attr("data-type")),a=$(".tab-pane").eq(t).find(".nearday").val()||30;PAGE.pageTable=r.eq(t).find("tbody"),PAGE.loadOrderRecord({type:t,days:a,page:1,pageSize:15})}),$("#j-table-main").on("click",".j-history-more",function(t){t.preventDefault();var a=$(this),e=a.parents("tr"),n=$(this).attr("data-order"),r=3==d.type?"查看":"查看详情";e.hasClass("on")?($(".j-look[data-no="+n+"]").remove(),a.html(r),e.removeClass("on")):(e.addClass("on"),a.html("收起"),e.after('<tr class="h-look j-look" data-no="'+n+'"><td colspan="7">正在加载..</td></tr>'),o(n))}),d.init()});