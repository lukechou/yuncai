require.config({paths:{jquery:"../lib/jquery",bootstrap:"../lib/bootstrap.min",app:"../common/app",inp:"../account/inp"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"},inp:{deps:["jquery"],exports:"inp"}}}),require(["jquery","app","inp","bootstrap"],function(t,e,a){a.init();var n=function(){"use strict";var n={smsControl:!0,nextTime:120,getCaptchaBtn:null,timeOutEvent:null,getOldCaptcha:function(){var a=this;a.smsControl&&t.ajax({url:"/account/bind_mail/uno-mail/ajax",type:"get",dataType:"json"}).done(function(t){1e5==t.retCode?(a.getCaptchaBtn="j-get-captcha",a.initSmsEvent()):e.handRetCode(t.retCode,t.retMsg)})},clearRun:function(){var t=this;clearInterval(t.timeOutEvent)},checkOldMobile:function(){var n=this,i=t("#old-captcha").val(),o=t("#userpwd").val();return a.regGroup.pwd.test(o)?void t.ajax({url:"/account/bind_mail/check/ajax",type:"get",dataType:"json",data:{captcha:i,password:o}}).done(function(a){1e5==a.retCode?(t("#j-info-text").remove(),t("#j-info-text2").fadeIn(),n.updateSmSEvent(!1),n.clearRun()):e.handRetCode(a.retCode,a.retMsg)}):void t("#userpwd").parents(".info-list").find(".j-tips-e").removeClass("hide")},getNewCaptcha:function(){var n=this,i=t("#email"),o=i.val();return a.regGroup.email.test(o)?void(n.smsControl&&t.ajax({url:"/account/bind_mail/upwd-mail/ajax",type:"get",dataType:"json",data:{email:o}}).done(function(t){1e5==t.retCode?(n.getCaptchaBtn="j-get-captcha2",n.initSmsEvent()):e.handRetCode(t.retCode,t.retMsg)})):void i.parents(".info-list").find(".j-tips-e").removeClass("hide")},modifyBindMobile:function(){var n=t("#email"),i=n.val(),o=t("#new-captcha").val();return a.regGroup.email.test(i)?void t.ajax({url:"/account/bind_mail/ajax",type:"get",dataType:"json",data:{email:i,captcha:o}}).done(function(a){1e5==a.retCode?(t("#j-info-text2").remove(),t("#bindcard-suc").fadeIn(),t("#bindEmail").html(i)):e.handRetCode(a.retCode,a.retMsg)}):void n.parents(".info-list").find(".j-tips-e").removeClass("hide")},updateSmsBtn:function(e){t("#"+this.getCaptchaBtn).html(e)},updateSmSEvent:function(e){var a=this;e?(a.smsControl=0,t("#"+this.getCaptchaBtn).addClass("no-event")):(a.smsControl=1,t("#"+this.getCaptchaBtn).removeClass("no-event"))},initSmsEvent:function(){var t=this;t.reStartTime=+new Date+1e3*t.nextTime,t.updateSmsBtn(t.nextTime+"秒后可重新发送"),t.updateSmSEvent(!0),t.timeOutEvent=setInterval(function(){var e="",a=+new Date,n=((t.reStartTime-a)/1e3).toFixed(0);n>0?(e=n,e+="秒后可重新发送",t.updateSmsBtn(e)):(t.updateSmsBtn("重新发送"),t.updateSmSEvent(!1),t.clearRun())},1e3)}};return n}();t("#j-get-captcha").on("click",function(t){n.getOldCaptcha()}),t("#j-next-step").on("click",function(t){n.checkOldMobile()}),t("#j-get-captcha2").on("click",function(t){n.getNewCaptcha()}),t("#j-bind-new-email").on("click",function(t){n.modifyBindMobile()})});