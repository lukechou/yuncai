require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",bootstrap:"../lib/bootstrap.min",store:"../lib/store.min",app:"../common/app",PAGE:"../account/newpager"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"},PAGE:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","app","store","lodash","PAGE","bootstrap"],function(e,a,t,s){"use strict";function n(t,s){e.ajax({url:"/user/follow/follow",type:"get",dataType:"json",data:t}).done(function(s){if(1e5==s.retCode){a.showTips("定制成功！");var n;e(".m-dzgd-nav a").each(function(a,t){e(this).hasClass("active")&&(n=e(this).attr("loty-name"))}),t=n?{loty_name:n,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:2}:{page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:2},i.loadDZFollow(t)}else a.handRetCode(s.retCode,s.retMsg)}).fail(function(){a.onServiceFail()})}function o(e,a){if(""===e)return e;var t=parseInt(e,10);return isNaN(t)?t=1:(t=t>=1?t:1,t=t),t=t>a?a:t}var i=new pager;i.loadDZFollow=function(a){i.ajaxUrl="/user/follow/query-follow-leader/ajx",i.pageElement=e(".j-dzgd-index-page-box"),i.initAjax(a),i.pageTable=e(".j-dzgd-index-table"),i.onSuccess=function(e){var t="",s="",n="",o=20*(a.page-1)+1;if(console.log(e),1e5==e.retCode){if(e.retData.data.length>0){s=e.retData.data;for(var d=1;d<=s.length;d++,o++)n=s[d-1],n.followed?1==n.follow_type?t+="<tr><td>"+o+'</td><td class="td2 j-user-name" csm-where="'+n.csm_where+'" follow-id="'+n.id+'" uid="'+n.uid+'" loty-name="'+n.loty_name+'"><a target="_blank" href="/user/profile/index/'+n.uid+'">'+n.username+'</a></td><td class="td3">'+n.loty_cnname+'</td><td class="td5"><span class="td5span">'+n.bonus_30day+'</span>元</td><td class="td6">'+n.bonus_total+'元</td><td class="td7">'+n.follower_num+'</td><td class="td8">'+n.follow_value+'元</td><td class="td9">'+n.follow_times+'次</td><td class="td10"><button class="btn-gray" disabled>已定制</button><a class="btn-sear j-high-level" target="_blank" href="/account/customizegd">修改</a></td></tr>':2==n.follow_type&&(t+="<tr><td>"+o+'</td><td class="td2 j-user-name" csm-where="'+n.csm_where+'" follow-id="'+n.id+'" uid="'+n.uid+'" loty-name="'+n.loty_name+'"><a target="_blank" href="/user/profile/index/'+n.uid+'">'+n.username+'</a></td><td class="td3">'+n.loty_cnname+'</td><td class="td5"><span class="td5span">'+n.bonus_30day+'</span>元</td><td class="td6">'+n.bonus_total+'元</td><td class="td7">'+n.follower_num+'</td><td class="td8">'+n.follow_value+'%</td><td class="td9">'+n.follow_times+'次</td><td class="td10"><button class="btn-gray" disabled>已定制</button><a class="btn-sear j-high-level" target="_blank" href="/account/customizegd">修改</a></td></tr>'):t+="<tr><td>"+o+'</td><td class="td2 j-user-name" csm-where="'+n.csm_where+'" follow-id="'+n.id+'" uid="'+n.uid+'" loty-name="'+n.loty_name+'"><a target="_blank" href="/user/profile/index/'+n.uid+'">'+n.username+'</a></td><td class="td3">'+n.loty_cnname+'</td><td class="td5"><span class="td5span">'+n.bonus_30day+'</span>元</td><td class="td6">'+n.bonus_total+'元</td><td class="td7">'+n.follower_num+'</td><td class="td8"><input type="text" placeholder="最少1" class="min-yuan j-min-yuan"/>元</td><td class="td9"><input type="text" placeholder="最多999" class="min-ci j-min-ci"/>次</td><td class="td10"><button class="btn-red j-dz-btn">定制</button><a class="btn-white j-high-level" target="_blank" href="/user/profile/index/'+n.uid+'">高级</a></td></tr>'}else t='<tr><td colspan="6">当前没有跟单用户</td></tr>';i.config.pageNum=Math.ceil(e.retData.size/i.config.pageSize),i.makePageHtml(),i.bindPageEvent(i.loadDZFollow)}else i.config.pageNum=0,i.makePageHtml(),t='<tr><td colspan="10">'+e.retMsg+"</td></tr>";this.appendTable(t)}},i.loadDZFollow({page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:2}),e(".m-dzgd-nav ul li a").on("click",function(a){var t=e(this),s=t.attr("loty-name");t.parents(".m-dzgd-nav").find("a").removeClass("active"),t.addClass("active");var n={sort_type:2,loty_name:s,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box"};i.loadDZFollow(n)}),e(".j-btn-sear").on("click",function(a){var t=e(".j-search-input").val(),s={username:t,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:2};if(!t)var s={page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:2};e(".m-dzgd-nav").find("a").removeClass("active"),e(".j-30-bonus").removeClass("icon-down").removeClass("icon-up-active").addClass("icon-down-active"),e(".j-total-bonus").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),e(".j-already-dz").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),i.loadDZFollow(s)}),e(document).delegate(".j-dz-btn","click",function(t){var s,o,i=e(this),d=i.parents("td").siblings(".j-user-name").attr("uid"),l=i.parents("td").siblings(".j-user-name").attr("loty-name"),c=i.parents("td").siblings(".td8").find(".j-min-yuan").val(),r=i.parents("td").siblings(".td9").find(".j-min-ci").val(),p=i.parents("td").siblings(".j-user-name").attr("follow-id");return c||r?c?r?(s={leader_id:d,loty_name:l,unit_price:c,max_buy_times:r,follow_id:p,data_type:"0"},o='<div class="frbox"><img src="http://static3.yuncai.com/front_images/fail.png" alt="success" class="icon"><div class="text"><p>每次认购金额：<span class="fc-3">'+c+'</span>元</p><p>定制次数：<span class="fc-3">'+r+"</span>次</p><p>确认按以上信息进行跟单吗？</p></div></div>",void a.checkLogin(null,{always:function(){a.showTips({text:o,type:2,onConfirm:function(){n(s,i)}})}},!0)):void a.showTips("定制次数不能为空"):void a.showTips("每次认购金额不能为空"):void a.showTips("每次认购金额和定制次数不能为空")}),e(document).delegate(".j-min-yuan","change",function(a){var t=e(this).val(),s=o(t,1e5);e(this).val(s)}),e(document).delegate(".j-min-yuan","keyup",function(a){var t=e(this).val(),s=o(t,1e5);e(this).val(s)}),e(document).delegate(".j-min-ci","change",function(a){var t=e(this).val(),s=o(t,999);e(this).val(s)}),e(document).delegate(".j-min-ci","keyup",function(a){var t=e(this).val(),s=o(t,999);e(this).val(s)}),e(document).delegate(".j-high-level","click",function(a){setTimeout(function(){e("#j-nav li:nth-child(3)").click()},3e3)}),e(document).delegate(".j-30-bonus","click",function(a){var t,s,n,o=e(this);e(".m-dzgd-nav a").each(function(a,s){e(this).hasClass("active")&&(t=e(this).attr("loty-name"))}),o.hasClass("icon-down-active")?(o.removeClass("icon-down-active").addClass("icon-up-active"),n=1):o.hasClass("icon-up-active")?(o.removeClass("icon-up-active").addClass("icon-down-active"),n=2):o.hasClass("icon-down")&&(o.removeClass("icon-down").addClass("icon-up-active"),o.parents("th").siblings(".th6").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),o.parents("th").siblings(".th7").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),n=1),s=t?{loty_name:t,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n}:{page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n},i.loadDZFollow(s)}),e(document).delegate(".j-total-bonus","click",function(a){var t,s,n,o=e(this);e(".m-dzgd-nav a").each(function(a,s){e(this).hasClass("active")&&(t=e(this).attr("loty-name"))}),o.hasClass("icon-down-active")?(o.removeClass("icon-down-active").addClass("icon-up-active"),n=3):o.hasClass("icon-up-active")?(o.removeClass("icon-up-active").addClass("icon-down-active"),n=4):o.hasClass("icon-down")&&(o.removeClass("icon-down").addClass("icon-up-active"),o.parents("th").siblings(".th5").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),o.parents("th").siblings(".th7").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),n=3),s=t?{loty_name:t,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n}:{page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n},i.loadDZFollow(s)}),e(document).delegate(".j-already-dz","click",function(a){var t,s,n,o=e(this);e(".m-dzgd-nav a").each(function(a,s){e(this).hasClass("active")&&(t=e(this).attr("loty-name"))}),o.hasClass("icon-down-active")?(o.removeClass("icon-down-active").addClass("icon-up-active"),n=5):o.hasClass("icon-up-active")?(o.removeClass("icon-up-active").addClass("icon-down-active"),n=6):o.hasClass("icon-down")&&(o.removeClass("icon-down").addClass("icon-up-active"),o.parents("th").siblings(".th5").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),o.parents("th").siblings(".th6").find("i").removeClass("icon-down-active").removeClass("icon-up-active").addClass("icon-down"),n=5),s=t?{loty_name:t,page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n}:{page:1,pageSize:20,pageElement:".j-dzgd-index-page-box",sort_type:n},i.loadDZFollow(s)})});