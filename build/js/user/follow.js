require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",bootstrap:"../lib/bootstrap.min",store:"../lib/store.min",app:"../common/app",PAGE:"../account/newpager"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"},PAGE:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","app","store","bootstrap","PAGE"],function(t,e,a,s){"use strict";function i(e){t.ajax({url:"/user/follow/un-follow",type:"get",dataType:"json",data:e}).done(function(t){a.showTips(1e5==t.retCode?{text:"撤销成功！"}:t.retMsg),l.loadDZFollowDetails({page:1,pageSize:10,pageElement:".j-dzgd-detail-page-box"})}).fail(function(){a.showTips("撤销失败！")})}function n(e,s){t.ajax({url:"/user/follow/follow",type:"get",dataType:"json",data:e}).done(function(t){1e5==t.retCode?(a.showTips("修改跟单设置成功！"),s.parents(".j-dzgd-div").find('input[type="text"]').val("")):a.handRetCode(t.retCode,t.retMsg),l.loadDZFollowDetails({page:1,pageSize:10,pageElement:".j-dzgd-detail-page-box"})}).fail(function(){a.onServiceFail()})}function d(t,e){if(""===t)return t;var a=parseInt(t,10);return isNaN(a)?a=1:(a=a>=1?a:1,a=a),a=a>e?e:a}var l=new pager;l.loadDZFollowDetails=function(e){l.ajaxUrl="/user/follow/my-followed",l.pageElement=t(".j-dzgd-detail-page-box"),l.initAjax(e),l.pageTable=t("#j-dzgd-detail-table");var a='<tr class="j-dzgd-tr"><td colspan="6"><div class="j-dzgd-div"><div class="dzgd-choose j-dzgd-choose"></div><div class="dzgd-gdje-content j-dzgd-gdje-content"><dl class="tips"><dt class="clearfix"><i class="icon icon-tan"></i><span>跟单提示</span></dt><dd>1.系统根据每次认购金额自动认购发起人发起合买的相应份数，若认购金额小于每份金额则无法认购该方案。<div class="gray-tips">&nbsp;&nbsp;&nbsp;例：每次认购金额10元，合买方案每份3元，则自动认购3份，共计支付9元。以此类推。</div></dd><dd>2.每个彩种只能定制一次。</dd></dl><div class="input-div"><p><label class="l-title">每次认购金额：</label><input type="text" class="j-unit-price">&nbsp;元，至少认购1元</p><p><label class="l-title">定制次数：</label><input type="text" class="j-max-buy-times">&nbsp;次，最多为<strong>999</strong>次</p><div class="ljgd-btn-div clearfix"><p class="ljgd-p1"><button class="btn btn-red j-imme-follow" data-type="0">立即跟单</button></p><p class="ljgd-p2 clearfix"><i class="icon icon-cgou j-checkbox"></i><span class="gray-tips">&nbsp;我已经阅读并同意&nbsp;</span><a href="javascript:;" data-toggle="modal" data-target="#tradeModal">委托投注规则</a></p></div></div></div><div class="dzgd-bfb-content r-dzgd-bfb-content j-dzgd-bfb-content"><dl class="tips"><dt class="clearfix"><i class="icon icon-tan"></i><span>跟单提示</span></dt><dd>1.最低认购比例为1%。进行自动认购时，您的账户余额不能低于每次认购金额。</dd><dd>2.每次认购金额 = 方案金额 × 认购比例，并会根据方案每份金额进行适当调整。</dd></dl><div class="input-div"><p><label class="l-title">每次认购比例：</label><input type="text" class="j-unit-percentage">&nbsp;%，至少认购1%，发起人在本彩种的平均方案金额的1%约为<strong class="fc-3">725.00</strong>元</p><p class="jiner-p clearfix j-jiner-choose"></p><p class="j-rengou-jiner"><label class="l-title">认购金额上限：</label><input type="text" class="j-max-price">&nbsp;元</p><p class="j-dzcs"><label class="l-title">定制次数：</label><input type="text" class="j-max-buy-times">&nbsp;次，最多为<strong>999</strong>次</p><div class="ljgd-btn-div clearfix"><p class="ljgd-p1"><button class="btn btn-red j-imme-follow" data-type="1">立即跟单</button></p><p class="ljgd-p2 clearfix"><i class="icon icon-cgou j-checkbox"></i><span class="gray-tips">&nbsp;我已经阅读并同意&nbsp;</span><a href="javascript:;" data-toggle="modal" data-target="#tradeModal">委托投注规则</a></p></div></div></div></div></td></tr>';l.onSuccess=function(e){var s="",i="",n="";if(1e5==e.retCode){if(e.retData.data.length>0){i=e.retData.data;for(var d=1;d<=i.length;d++)switch(n=i[d-1],parseInt(n.follow_type)){case 1:s+='<tr class="dzgd-tr"><td class="j-loty-name" loty-name="'+n.loty_name+'" ldr-id="'+n.ldr_id+'" leader-uid="'+n.leader_uid+'" fid="'+n.id+'" follow-type="'+n.follow_type+'" follow-max-money="'+n.follow_max_money+'">'+n.loty_cnname+'</td><td class="leader-username"><a href="/user/profile/index/'+n.leader_uid+'" target="_blank">'+n.leader_username+"</a></td><td>"+n.dateline+'</td><td><span class="fc-3">'+n.follow_value+'</span>元</td><td class="j-cishu">'+n.follow_times+'</td><td><button class="btn btn-sear btn-oper j-mod-dzgd">修改</button><a href="javascript:;" class="j-undo">撤销</a></td></tr>'+a;break;case 2:s+='<tr class="dzgd-tr"><td class="j-loty-name" loty-name="'+n.loty_name+'" ldr-id="'+n.ldr_id+'" leader-uid="'+n.leader_uid+'" fid="'+n.id+'" follow-type="'+n.follow_type+'" follow-max-money="'+n.follow_max_money+'">'+n.loty_cnname+'</td><td class="leader-username"><a href="/user/profile/index/'+n.leader_uid+'" target="_blank">'+n.leader_username+"</a></td><td>"+n.dateline+'</td><td><span class="fc-3">'+n.follow_value+'</span>%</td><td class="j-cishu">'+n.follow_times+'</td><td><button class="btn btn-sear btn-oper j-mod-dzgd">修改</button><a href="javascript:;" class="j-undo">撤销</a></td></tr>'+a}}else s='<tr><td colspan="6">当前没有跟单用户</td></tr>';l.config.pageNum=Math.ceil(e.retData.size/l.config.pageSize),l.makePageHtml(),l.bindPageEvent(l.loadDZFollowDetails)}else l.config.pageNum=0,l.makePageHtml(),s='<tr><td colspan="6">'+e.retMsg+"</td></tr>";this.appendTable(s),t("#j-dzgd-detail-table tr:last-child").prev("tr").find("td").css({borderBottom:"none"})}},l.loadDZFollowDetails({page:1,pageSize:10,pageElement:".j-dzgd-detail-page-box"}),t(document).delegate(".j-undo","click",function(e){var s=t(this),n=s.parents(".dzgd-tr").find(".j-loty-name").attr("fid"),d=s.parents(".dzgd-tr").find(".leader-username").text(),l={follow_id:n};a.showTips({text:'<div class="frbox"><div class="text"><p>确认撤销对'+d+"的跟单吗？</p></div></div>",type:2,className:"undoModel",onConfirm:function(){i(l)}})}),t(document).delegate(".j-mod-dzgd","click",function(){var e=t(this).parent("td").parent("tr").next("tr.j-dzgd-tr"),a=t(this),s=a.parents(".dzgd-tr").next(".j-dzgd-tr").find(".j-dzgd-choose"),i=e.find(".j-dzgd-gdje-content"),n=e.find(".j-dzgd-bfb-content"),d=e.find(".j-jiner-choose"),l=e.find(".j-rengou-jiner"),o=a.parents("td").siblings(".j-loty-name").attr("follow-type"),p=a.parents(".dzgd-tr").find(".fc-3").text(),c=a.parents("td").siblings(".j-cishu").text(),r=parseInt(a.parents("td").siblings(".j-loty-name").attr("follow-max-money"));if("修改"==a.text())switch(a.text("收起"),o){case"1":s.html('<span><input type="radio" class="gdje" checked="checked"><label>按固定金额定制跟单</label></span><span><input type="radio" class="bfb"><label>按百分比定制跟单</label></span>'),e.css({display:"table-row"}),i.show(),i.find(".j-unit-price").val(p),i.find(".j-max-buy-times").val(c),i.find(".j-imme-follow").text("确认修改"),n.hide();break;case"2":switch(s.html('<span><input type="radio" class="gdje"><label>按固定金额定制跟单</label></span><span><input type="radio"  checked="checked" class="bfb"><label>按百分比定制跟单</label></span>'),e.css({display:"table-row"}),i.hide(),n.show(),n.find(".j-unit-percentage").val(p),n.find(".j-max-buy-times").val(c),r){case 0:d.html('<span><input type="radio" checked="checked" class="wux-jiner"><label>&nbsp;无金额上限</label></span><span><input type="radio" class="set-up-jiner"><label>&nbsp;设置金额上限</label><span class="gray-tips">(超过上限时，仅购买上限)</span></span>'),l.hide();break;default:d.html('<span><input type="radio" class="wux-jiner" /><label>&nbsp;无金额上限</label></span><span><input type="radio"  class="set-up-jiner" checked="checked"/><label>&nbsp;设置金额上限</label><span class="gray-tips">(超过上限时，仅购买上限)</span></span>'),l.show(),n.find(".j-max-price").val(r)}n.find(".j-imme-follow").text("确认修改")}else"收起"==a.text()&&(a.text("修改"),s.html(),e.css({display:"none"}),n.show(),i.hide())}),t(document).delegate(".j-dzgd-choose span","click",function(e){var a=t(this),s=a.find('input[type="radio"]').attr("class");a.siblings("span").find('input[type="radio"]').removeAttr("checked"),a.find('input[type="radio"]').prop("checked",!0);var i=a.parents(".j-dzgd-choose").siblings(".j-dzgd-gdje-content"),n=a.parents(".j-dzgd-choose").siblings(".j-dzgd-bfb-content"),d='<span><input type="radio" checked="checked" class="wux-jiner"><label>&nbsp;无金额上限</label></span><span><input type="radio" class="set-up-jiner"><label>&nbsp;设置金额上限</label><span class="gray-tips">(超过上限时，仅购买上限)</span></span>',l=n.find(".j-jiner-choose"),o=n.find(".j-rengou-jiner"),p=n.find(".j-imme-follow");switch(s){case"gdje":i.show(),l.html(),n.hide();break;case"bfb":n.show(),l.html(d),o.hide(),i.hide(),p.attr("data-type",1)}}),t(document).delegate(".j-jiner-choose span","click",function(e){var a=t(this),s=a.find('input[type="radio"]').attr("class");a.siblings("span").find('input[type="radio"]').removeAttr("checked"),a.find('input[type="radio"]').prop("checked",!0);{var i=a.parents(".j-jiner-choose").next(".j-rengou-jiner"),n=a.parents(".j-jiner-choose").siblings(".ljgd-btn-div").find(".j-imme-follow");a.parents(".j-jiner-choose").siblings(".j-dzcs")}switch(s){case"wux-jiner":i.hide(),n.attr({"data-type":1});break;case"set-up-jiner":i.show(),n.attr({"data-type":2})}}),t(document).delegate(".j-checkbox","click",function(e){e.preventDefault();var a=t(this);a.hasClass("icon-cgou")?a.removeClass("icon-cgou").addClass("icon-cbox"):a.removeClass("icon-cbox").addClass("icon-cgou")}),t(document).delegate(".j-imme-follow","click",function(e){e.preventDefault();var s=t(this),i=s.parents(".j-dzgd-tr").prev(".dzgd-tr").find(".j-loty-name").attr("leader-uid");i=void 0==i?uid:i;var d,l,o,p,c,r=s.parents(".j-dzgd-tr").prev(".dzgd-tr").find(".j-loty-name").attr("loty-name"),u={},f=s.parents(".j-dzgd-tr").prev(".dzgd-tr").find(".j-loty-name").attr("ldr-id"),g=s.attr("data-type");if(!s.parents(".ljgd-p1").next(".ljgd-p2").find(".j-checkbox").hasClass("icon-cgou"))return void a.showTips("请先阅读并同意《委托投注规则》后才能继续");switch(g){case"0":if(d=s.parents(".input-div").find(".j-unit-price").val(),l=s.parents(".input-div").find(".j-max-buy-times").val(),!d&&!l)return void a.showTips("每次认购金额和定制次数不能为空");if(!d)return void a.showTips("每次认购金额不能为空");if(!l)return void a.showTips("定制次数不能为空");u={leader_id:i,loty_name:r,unit_price:d,max_buy_times:l,follow_id:f,data_type:g},c='<div class="frbox"><img src="http://static3.yuncai.com/front_images/fail.png" alt="success" class="icon"><div class="text"><p>每次认购金额：<span class="fc-3">'+d+'</span>元</p><p>定制次数：<span class="fc-3">'+l+"</span>次</p><p>确认按以上信息进行跟单吗？</p></div></div>";break;case"1":if(o=s.parents(".input-div").find(".j-unit-percentage").val(),l=s.parents(".input-div").find(".j-max-buy-times").val(),!o&&!l)return void a.showTips("每次认购比例和定制次数不能为空");if(!o)return void a.showTips("每次认购比例不能为空");if(!l)return void a.showTips("定制次数不能为空");u={leader_id:i,loty_name:r,unit_percentage:o,max_buy_times:l,follow_id:f,data_type:g},c='<div class="frbox"><img src="http://static3.yuncai.com/front_images/fail.png" alt="success" class="icon"><div class="text"><p>每次认购比例：<span class="fc-3">'+o+'</span>%</p><p>定制次数：<span class="fc-3">'+l+"</span>次</p><p>确认按以上信息进行跟单吗？</p></div></div>";break;case"2":if(o=s.parents(".input-div").find(".j-unit-percentage").val(),p=s.parents(".input-div").find(".j-max-price").val(),l=s.parents(".input-div").find(".j-max-buy-times").val(),!(o||p||l))return void a.showTips("每次认购比例、认购金额上限、定制次数不能为空");if(o&&!p&&!l)return void a.showTips("认购金额上限、定制次数不能为空");if(p&&!o&&!l)return void a.showTips("每次认购比例、定制次数不能为空");if(l&&!o&&!p)return void a.showTips("每次认购比例、认购金额上限不能为空");if(!o)return void a.showTips("每次认购比例不能为空");if(!p)return void a.showTips("认购金额上限不能为空");if(!l)return void a.showTips("定制次数不能为空");u={leader_id:i,loty_name:r,unit_percentage:o,max_price:p,max_buy_times:l,follow_id:f,data_type:g},c='<div class="frbox"><img src="http://static3.yuncai.com/front_images/fail.png" alt="success" class="icon"><div class="text"><p class="dzgd-tL">每次认购比例：<span class="fc-3">'+o+'</span>%</p><p class="dzgd-tL">认购金额上限：<span class="fc-3">'+p+'</span>元</p><p class="dzgd-tL">定制次数：<span class="fc-3">'+l+'</span>次</p><p class="dzgd-tL-bot">确认按以上信息进行跟单吗？</p></div></div>'}a.checkLogin(null,{always:function(){a.showTips({text:c,type:2,onConfirm:function(){n(u,s)}})}},!0)}),t(document).delegate(".j-dzgd-gdje-content .j-unit-price","change",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>1e5?1e5:i,t(this).val(i)}),t(document).delegate(".j-dzgd-gdje-content .j-unit-price","keyup",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>1e5?1e5:i,t(this).val(i)}),t(document).delegate(".j-max-buy-times","change",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>999?999:i,t(this).val(i)}),t(document).delegate(".j-max-buy-times","keyup",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>999?999:i,t(this).val(i)}),t(document).delegate(".j-dzgd-bfb-content .j-unit-percentage","change",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>99?99:i,t(this).val(i)}),t(document).delegate(".j-dzgd-bfb-content .j-unit-percentage","keyup",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>99?99:i,t(this).val(i)}),t(document).delegate(".j-dzgd-bfb-content .j-max-price","change",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>1e5?1e5:i,t(this).val(i)}),t(document).delegate(".j-dzgd-bfb-content .j-max-price","keyup",function(e){var a=t(this).attr("data-max"),s=t(this).val(),i=d(s,a);i=i>1e5?1e5:i,t(this).val(i)})});