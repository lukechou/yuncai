require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",bootstrap:"../lib/bootstrap.min",store:"../lib/store.min",app:"../common/app",pager:"../account/pager"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","store","app","bootstrap","pager"],function(t,a,s,e){"use strict";function i(t,s){var i=1;return a.isNaN(t)&&(e.showTips("请输入整数购买份数"),i=0),(0>=t||e.isDecimal(t))&&(e.showTips("请输入整数购买份数"),i=0),t>s&&(e.showTips("超过最大可购买份额"),i=0),i}function n(){var a=t(".j-sort-schedule"),s=t(".j-sort-project-price"),e=t(".j-sort-unit-price");a.removeClass(),a.addClass("icon icon-down j-sort-schedule"),s.removeClass(),s.addClass("icon icon-down j-sort-project-price"),e.removeClass(),e.addClass("icon icon-down j-sort-unit-price")}function o(){PAGE.pageTable=t("#projectList"),PAGE.loadPrjctLst({qid:t("#qid").val(),status:"",tc:"",aegis:"",username:"",pageSize:10,page:1}),c(),t(window).on("resize",function(t){c()})}function c(){var a=t(".ft"),s=t(window).height(),e=a.height(),i=a[0].offsetTop,n=s-e-i;n>0?a.css("marginTop",n):a.css("marginTop",0)}PAGE.loadPrjctLst=function(a){var s=window.location.pathname.replace(/\/*$/,"");PAGE.ajaxUrl=s+"/ajax",PAGE.pageElement=t("#j-page-area"),PAGE.initAjax(a),PAGE.onSuccess=function(s){var i="",n="",o="",c="";if(1e5!=s.retCode&&e.showTips(s.retMsg),s.retData&&s.retData.data.length>0)for(var r=s.retData.data,l=1;l<=r.length;l++){switch(c=r[l-1],a.status){case"2":n='<span class="miss-tips">已满员</span>',o='<a class="miss-dan" href="'+c.detailURI+'">详情</a>\r\n                <input type="hidden" name="joinUrl" class="joinUrl" value="'+c.joinURI+'" />\r\n                <input type="hidden" name="pid" class="pid" value="'+c.id+'" />';break;case"3":n='<span class="miss-tips">已撤单</span>',o='<a class="miss-dan" href="'+c.detailURI+'">详情</a>\r\n                <input type="hidden" name="joinUrl" class="joinUrl" value="'+c.joinURI+'" />\r\n                <input type="hidden" name="pid" class="pid" value="'+c.id+'" />';break;default:n='<input type="text" class="text-left u-ci w50 j-gou-count" placeholder="剩余'+c.lessNum+'份" data-max="'+c.lessNum+'" maxlength="'+c.lessNum.toString().split("").length+'">',o='<button data-type="1" data-one="'+c.unitPrice+'" class="text-left btn btn-s btn-c1 j-gou-btn">购买</button><a href="'+c.detailURI+'">详情</a><input type="hidden" name="joinUrl" class="joinUrl" value="'+c.joinURI+'" /><input type="hidden" name="pid" class="pid" value="'+c.id+'" />'}i+="<tr>\r\n                  <td>"+l+'</td>\r\n                  <td><a class="username" href="'+c.user_profile_url+'">'+c.username+"</a></td>\r\n                  <td>"+c.schedule+' %</td>\r\n                  <td class="tb-4 fc-3 j-mtotal">'+c.price+'元</td>\r\n                  <td class="text-left">'+c.unitPrice+"元</td><td>"+n+o+"</td></tr>"}else i='<td colspan="6" style="height:50px">暂无相关记录</td>';PAGE.config.pageNum=Math.ceil(s.retData.totalRecord/a.pageSize),PAGE.makePageHtml(),PAGE.bindPageEvent(PAGE.loadPrjctLst),s.retData.totalRecord>a.pageSize&&(t("#j-page-line").show(),t("#j-page-area").show()),this.appendTable(i),t("tbody tr:nth-child(odd) td").css("background","#f1f1f1")},PAGE.onFail=function(){}};var r=function(a){t.ajax({url:a.joinURI,type:"get",dataType:"json",data:{pid:a.prjctId,buyNum:a.byNum,unikey:(new Date).valueOf()}}).done(function(s){1e5==s.retCode?(a.onSuccess&&a.onSuccess(),e.updateUserMoney(),e.showTips({text:"合买成功!",type:1,onConfirm:function(){window.location.reload()}}),t("body").on("click",".close",function(t){window.history.go(0)})):e.handRetCode(s.retCode,s.retMsg)}).fail(function(){e.onServiceFail()})};t("#j-gou").on("click",".j-gou-btn",function(){var s=t(this).parents("tr"),n=s.find(".j-gou-count"),o=t(this).attr("data-one"),c=Number(n.val()),l=Number(n.attr("data-max")),d={},p={},u="",h="",m=s.find(".j-mtotal").html(),g=t("#j-mqi").html(),f="",j={ssq:"双色球",dlt:"大乐透",jczq:"竞彩足球",pl3:"排列3",pl5:"排列5",fc3d:"福彩3D",qlc:"七乐彩",qxc:"七星彩",bjdc:"足球单场"},v=j[lotyName],b=s.find(".joinUrl").val().split("/"),y={bqc_gg:"半全场",spf_gg:"胜平负",rqspf_gg:"让球胜平负",zjq_gg:"总进球",bf_gg:"比分",hhtz_gg:"混合投注",zjq:"总进球",bf:"比分",sxds:"上下单双",spf:"胜平负",bqc:"半全场"},w=y[b[b.length-1]]||"";if(i(c,l)){d={byNum:c,joinURI:s.find(".joinUrl").val(),prjctId:s.find(".pid").val(),onSuccess:function(t){l-=c,n.attr({placeholder:"最多"+l,"data-max":l})}},g&&(f="第<span>"+g+"</span>期"),u=a.template('<div class="frbox"><img src="'+staticHostURI+'/front_images/fail.png" alt="success" class="icon"><div class="text"><p><%= lotyName%> '+f+w+'</p><p>方案总金额<span class="fc-3"><%= total %></span></p><p>您认购<span><%= pay %></span>份</p><p>共需支付<span class="fc-3"><%= payMoney %>.00</span>元</p><div class="btns"><button class="btn btn-danger" id="buyConfirm">确定</button><button class="btn btn-gray" data-dismiss="modal">取消</button></div></div></div>'),h=u({lotyName:v,total:m,pay:c,payMoney:c*o}),p={html:h};var C=c*o,q="";q+='<p>本次需支付：<span class="fc-3 mlr5">'+C+".00</span>元",e.checkLogin(C,{enoughMoney:function(){e.showTips(p),t("#buyConfirm").one("click",function(t){r(d)})},lessMoneyTips:q})}}),t("body").on("click","#hemaiRefresh",function(t){window.location.reload()}),t("#projectList").on("change",".j-gou-count",function(a){var s=t(this).attr("data-max"),e=Number(t(this).val());isNaN(e)?t(this).val(s):e>s&&t(this).val(s)}),t("#searchBtn").on("click",function(a){a.preventDefault();var s=t("#status").val(),e=t("#tc").val(),i=t("#aegis").val(),n=t("#username").val(),o={qid:t("#qid").val(),status:s,tc:e,aegis:i,username:n,pageSize:10,page:1};PAGE.loadPrjctLst(o)}),t(".j-sort-schedule").on("click",function(a){a.preventDefault();var s=1;t(this).hasClass("icon-down")||t(this).hasClass("icon-down-active")?(n(),t(this).removeClass(),t(this).addClass("icon icon-up-active j-sort-schedule"),s=2):(n(),t(this).removeClass(),t(this).addClass("icon icon-down-active j-sort-schedule")),PAGE.loadPrjctLst({qid:t("#qid").val(),status:"",tc:"",aegis:"",username:"",pageSize:10,sort:s,page:1})}),t(".j-sort-project-price").on("click",function(a){a.preventDefault();var s=3;t(this).hasClass("icon-down")||t(this).hasClass("icon-down-active")?(n(),t(this).removeClass(),t(this).addClass("icon icon-up-active j-sort-project-price"),s=4):(n(),t(this).removeClass(),t(this).addClass("icon icon-down-active j-sort-project-price")),PAGE.loadPrjctLst({qid:t("#qid").val(),status:"",tc:"",aegis:"",username:"",pageSize:10,sort:s,page:1})}),t(".j-sort-unit-price").on("click",function(a){a.preventDefault();var s=5;t(this).hasClass("icon-down")||t(this).hasClass("icon-down-active")?(n(),t(this).removeClass(),t(this).addClass("icon icon-up-active j-sort-unit-price"),s=6):(n(),t(this).removeClass(),t(this).addClass("icon icon-down-active j-sort-unit-price")),PAGE.loadPrjctLst({qid:t("#qid").val(),status:"",tc:"",aegis:"",username:"",pageSize:10,sort:s,page:1})}),o()});