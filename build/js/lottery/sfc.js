require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",bootstrap:"../lib/bootstrap.min",store:"../lib/store.min",app:"../common/app",core:"../lib/core"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","app","store","bootstrap","core"],function(t,a,e,n){"use strict";function o(a){t.trim(a.val())==a.attr("data-text")&&(a.parents("p").find(".j-btext-total").html(0),a.val(""))}function s(a){var e=a.attr("data-text");""==t.trim(a.val())&&(a.val(e),a.parents("p").find(".j-btext-total").html(e.length))}function i(t){var a=t.val().length,e=parseInt(t.attr("data-size"));e>=a?t.parents("p").find(".j-btext-total").html(a):(t.val(t.val().slice(0,e-1)),t.parents("p").find(".j-btext-total").html(e))}function r(){var a=u.money,e=t("#share-num").val()||a,n="",o="",s=t("#part_buy").val(),i="",r=1*t("#commission_percent").val()||0,l="",p="",h=parseInt(t("#part_aegis_num").val())||0,d=t("#has_part_aegis")[0].checked||!1;return e=Number(e.replace(/[^0-9]/g,"")),s=Number(s.replace(/[^0-9]/g,"")),0>=a?void c(0,r,0,0,0,0,0):(a%e===0?n=a/e:(n=1,e=a),0>=s&&(s=1),s>e&&(s=e),r>s/e*100&&(s=Math.ceil(e*r*.01)),o=s*n,t("#has_part_aegis")[0]&&(d=t("#has_part_aegis")[0].checked),d?(t("#part_aegis_num")[0].disabled=!1,l=0===h?.8>s/e?Math.ceil(.2*e):e-s:e>h+s?.2>h/e?Math.ceil(.2*e)+s>e?e-s:Math.ceil(.2*e):h:e-s,p=(l/e*100).toFixed(2)):(t("#part_aegis_num")[0].disabled=!0,l=0,p="0.00"),i=0===a?0:(s/e*100).toFixed(2),void c(e,n,s,r,i,p,l))}function c(a,e,n,o,s,i,r){var c={},l=r*e||0,u=(n+r)*e||0;0===a&&(e=0),c.shareNum=a,c.partBuyNum=n,c.unitPrice=e,c.commissionPercent=parseInt(t("#commission_percent").val()),c.partAegisNum=r,t("#share-num").val(a),t(".j-unit-price").html(e),t("#part_buy").val(n),t("#part_buy_percent").html(s),t("#part_aegis_num").val(r),t("#part_aegis_percent").html(i),t("#buy_money_tips").html(n*e),t("#aegis_money_tips").html(l),t("#total_money_tips").html(u)}var l=function(){function o(t){return this instanceof o?void 0:new o(t)}return o.prototype={isAgreen:!0,match:[],group:null,zhus:0,money:0,beishu:1,uniqMatch:[],payMoney:0,lotyCNName:Config.lotyCNName,indexMap:[3,1,0],data:null,qihao:t("#j-qihao").val(),qihaoId:t("#j-qihao-id").val()},o.prototype.init=function(){var t=this;for(var a in Config.MatchData)Config.MatchData.hasOwnProperty(a)&&(t.data=Config.MatchData[a]);t.createTable(),t.bindEvent()},o.prototype.createTable=function(){var e=this,n="",o=e.data,s=null,i=[];n+='<dl class="j-data-dl">';for(var r=0;r<o.length;r++)s=o[r],i=["-","-","-"],s.spf_gg_sp&&a.isString(s.spf_gg_sp)&&(i=s.spf_gg_sp.split("|")),n+='<dd matchcode="'+s.matchcode+'" data-mindex="'+r+'">',n+='<span class="co1">'+s.matchcode+"</span>",n+='<span class="co2">'+s.league+"</span>",n+='<span class="co3">'+s.game_start_time+"</span>",n+='<span class="co4"><strong class="j-maind">'+s.home+'</strong>  <strong class="j-ked">'+s.away+"</strong></span>",n+='<span class="co7 sp-btn j-sp-btn" index="0" data-item="胜" gametype="spf" sp="'+i[0]+'">'+i[0]+"</span>",n+='<span class="co8 sp-btn j-sp-btn" index="1" data-item="平" gametype="spf" sp="'+i[1]+'">'+i[1]+"</span>",n+='<span class="co9 sp-btn j-sp-btn" index="2" data-item="负" gametype="spf" sp="'+i[2]+'">'+i[2]+"</span>",n+="</dd>";n+="</dl>",t("#j-data-body").html(n)},o.prototype.getCodes=function(t,a){for(var e=this,n=null,o="",s=[],i=[],r=0;r<t.length;r++){s=[],n=a[t[r]];for(var c=0;c<n.length;c++)s.push(e.indexMap[n[c].index]);i.push(s.join(","))}return o=i.join("/")},o.prototype.getSubmitParams=function(){var a=this,e=null,n=[],o=null,s=null;s=a.group;for(var i in s)s.hasOwnProperty(i)&&n.push(i);return o=a.getCodes(n,s),e={zhushu:a.zhus,beishu:a.beishu,content:o,qihao:a.qihao,qihaoId:a.qihaoId,unikey:t.now()}},o.prototype.getChooseGroupCode=function(t){for(var a=this,e="",n=0;n<t.length;n++)e+=a.indexMap[t[n].index];return e},o.prototype.updateChooseDetail=function(){var a=this,e=a.group,n="",o="",s=0,i=a.data,r=7,c=null;n='<li class="t1">投注</li>',o='<li class="t1">投注</li>';for(var l=0;l<i.length;l++)c=i[l],r>l?e[c.matchcode]?(s++,n+='<li class="t2">'+a.getChooseGroupCode(e[c.matchcode])+"</li>"):n+='<li class="t2"></li>':e[c.matchcode]?(s++,o+='<li class="t2">'+a.getChooseGroupCode(e[c.matchcode])+"</li>"):o+='<li class="t2"></li>';t(".j-m-lscontent1").html(n),t(".j-m-lscontent2").html(o),t(".j-gameNumber").text(l)},o.prototype.craeteTzTable=function(){for(var t=this,e="",n="",o="",s=[],i="",r=null,c=null,l="",u="",p='<table class="touzhu-table"><tr class="grey-bg"><td>场次</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td></tr><tr class="h-100"><td>主队</td>',h='</tr><tr class="grey-bg"><td colspan="15" class="fc-3d">VS</td></tr><tr class="h-100"><td>客队</td>',d='</tr><tr class="grey-bg"><td>投注</td>',m="</tr></table>",g=0;g<t.data.length;g++)c=t.data[g],r=c.matchcode,l=c.home.replace(/\s/g,""),u=c.away.replace(/\s/g,""),n+='<td class="fc-3d">'+l+"</td>",o+='<td class="fc-3d">'+u+"</td>",s=a.map(t.group[r],function(a){return t.indexMap[a.index]}),e+='<td class="fc-3d">'+s.join(" ")+"</td>";return i=p+n+h+o+d+e+m},o.prototype.checkStatus=function(){var a=this,e={statu:!0,info:""};return t("#j-agreen").hasClass("icon-cgou")?a.uniqMatch.length<Config.matchsTotal&&(e.statu=!1,e.info="请对"+Config.matchsTotal+"场比赛的赛过进行竞猜，每场比赛至少竞猜一个赛果"):(e.statu=!1,e.info="请先阅读并同意《委托投注规则》后才能继续"),e},o.prototype.bindEvent=function(){var n=this;t("#j-data-body").on("click",".j-sp-btn",function(e){e.preventDefault();var o=t(this),s=o.attr("index"),i=o.attr("sp"),r=o.attr("data-item"),c=o.attr("gametype"),l=o.parents("dd");o.toggleClass("active"),o.hasClass("active")?n.addOneItem(s,l,i,r,c):n.removeOneItem(s,l),n.group=a.groupBy(n.match,function(t){return t.matchcode}),n.uniqMatch=a.uniq(n.match,"matchcode"),n.uniqMatch.length>=Config.matchsTotal?(n.zhus=n.getTotalZhus(),n.money=2*n.zhus,t(".j-gameZhu").text(n.zhus),t("#j-totalMoney").text(n.money)):n.uniqMatch.length<Config.matchsTotal&&(n.zhus=0,n.money=0,t(".j-gameZhu").text(n.zhus),t("#j-totalMoney").text(n.money)),n.updateChooseDetail(),n.updateMoney()}),t("#j-btn-clear").click(function(a){t(".dataBody").find("span").removeClass("active"),t(".j-m-lscontent1").html('<li class="t1">投注</li>'),t(".j-m-lscontent2").html('<li class="t1">投注</li>'),n.match=[],n.group=null,n.zhus=0,n.money=0,n.beishu=1,t(".j-gameNumber").text(0),t(".j-gameZhu").text(n.zhus),t(".j-quick-bei").val(n.beishu),t("#j-totalMoney").text(n.money)}),t(".j-coutn-total").on("click",".j-count",function(a){{var e=t(this).siblings(".btn-results"),o=t(this).attr("data-c");e.attr("data-r")}n.updateCount(e,o),n.updateMoney()}),t("#orderRule").on("click",".icon",function(a){var e=t(this);e.toggleClass("icon-cbox").toggleClass("icon-cgou"),n.isAgreen=e.hasClass("icon-cgou")}),t(".j-quick-bei").on("change",function(a){var e=t(this).val(),o=n.filterNum(e,99999);t(this).val(o),n.beishu=o,n.updateMoney()}),t(".j-quick-bei").on("keyup",function(a){var e=t(this).val(),o=n.filterNum(e,99999);t(this).val(o),n.updateMoney()}),t("#j-ljtzBtn").on("click",function(t){var a=n.checkStatus();if(!a.statu)return void e.showTips(a.info);var o=n.getSubmitParams(),s='<div class="ljtz-info"><p>投注金额：总计<strong class="fc-3"> '+n.money+" </strong>元，共<strong> "+n.zhus+" </strong>注，投注<strong> "+n.beishu+" </strong>倍</p></div>",i="";i=n.craeteTzTable(),n.payMoney=n.money,n.buyLoty(function(){e.showTips({type:2,text:i+s,title:"投注信息确认",className:"touzhuinfo-modal",onConfirm:function(){n.buy(o)}})},o)}),t("#j-hemai").on("click",function(a){a.preventDefault();var e=n.getSubmitParams();e.shareNum=t("#share-num").val(),e.buyNum=Number(t("#part_buy").val()),e.aegisNum=Number(t("#part_aegis_num").val()),e.tichengPercent=t("#commission_percent").val(),e.shareLevel=t("#hemaiModal .br-set.active").attr("data-set"),e.projectTitle=t("#title").val(),e.projectText=t("#desc").val(),Config.payMoney=2*e.zhushu*e.beishu/e.shareNum*(e.buyNum+e.aegisNum),n.buyLoty(function(){n.buy(e,!0),t("#hemaiModal").modal("hide")},e,!0)}),t("#j-fqhmBtn").on("click",function(a){var o=n.checkStatus();if(!o.statu)return void e.showTips(o.info);var s=n.getSubmitParams(),i=('<div class="fqhm-info"><p>投注金额：总计<strong class="fc-3"> '+n.money+" </strong>元，共<strong> "+n.zhus+" </strong>注，投注<strong> "+n.beishu+" </strong>倍</p></div>","");i=n.craeteTzTable(),t("#j-modal-table").html(i),n.payMoney=1,n.buyLoty(function(){t("#hemaiModal").modal("show"),r()},s)})},o.prototype.buy=function(a,o){var s=this,i="buy-self",r="";o&&(i="buy-together"),r="/lottery/football/"+i+"/"+Config.lotyName,t.ajax({url:r,type:"post",dataType:"json",data:a}).done(function(t){1e5==t.retCode?(n.set("lotyName",Config.lotyName),n.set("payMoney",s.payMoney),n.set("projectNo",t.retData.projectNo),n.set("lotyCNName",Config.lotyCNName),window.location.href="/html/lottery/trade/success.html"):e.handRetCode(t.retCode,t.retMsg)}).fail(function(){e.onServiceFail()})},o.prototype.buyLoty=function(t,a,n){var o=this,s="";s+="<p>"+o.lotyCNName+"</p>",n?(s+='<p>方案总金额<span class="fc-3 mlr5">'+a.zhushu*a.beishu*2+".00</span>元</p>",s+='<p>您认购<span class="fc-3 mlr5">'+a.buyNum+'</span>份, 保底<span class="fc-3 mlr5">'+a.aegisNum+"</span>份</p>"):s+='<p>共<span class="fc-3 mlr5">'+a.zhushu+'</span>注，<span class="fc-3 mlr5">'+a.beishu+"</span>倍",s+='<p>本次需支付：<span class="fc-3 mlr5">'+o.payMoney+".00</span>元",e.checkLogin(o.payMoney,{enoughMoney:t,lessMoneyTips:s})},o.prototype.updateCount=function(t,a){var e=parseInt(t.val(),10);1==a?e++:e--,e=e>=1?e:1,e=e>99999?99999:e,this.beishu=e,t.val(e)},o.prototype.filterNum=function(t,a){if(""===t)return t;var e=parseInt(t,10);return isNaN(e)?e=1:(e=e>=1?e:1,e=e),e=e>a?a:e},o.prototype.addOneItem=function(t,a,e,n,o){var s=a.attr("matchcode"),i=Number(a.attr("data-mindex"));this.match.push({index:t,type:o,matchcode:s,sp:e,title:n,matchIndex:i})},o.prototype.removeOneItem=function(t,e){var n=this,o=e.attr("matchcode");a.remove(n.match,function(a){return a.index==t&&a.matchcode==o})},o.prototype.getTotalZhus=function(){var t=this,a=0,e=1,n=[];for(var o in t.group)t.group.hasOwnProperty(o)&&n.push(t.group[o]);for(var s=YC.Unit.explodeCombined(n,Config.matchsTotal),i=s.length-1;i>=0;i--){e=1;for(var r=s[i].length-1;r>=0;r--)e*=s[i][r].length;a+=e}return a},o.prototype.updateMoney=function(){var a=t(".j-quick-bei"),e=parseInt(a.val(),10);this.money=2*this.zhus*e,t("#j-totalMoney").text(this.money)},o}(),u=new l;u.init(),t("#share-num").on("change",function(t){r()}),t("#part_buy").on("change",function(t){r()}),t("#commission_percent").on("change",function(a){var e=parseInt(t(this).val())||0,n=Math.floor(t("#part_buy_percent").html());e>n&&(t("#part_buy").val(Math.ceil(t("#commission_percent").val()/100*(t("#share-num").val()||0))),r())}),t("#has_part_aegis").on("change",function(a){t(this)[0].checked?t("#part_aegis_num").removeAttr("disabled"):(t("#part_aegis_num").attr("disabled","disabled"),t("#part_aegis_num").val(0),t("#part_aegis_percent").html("0.00")),r()}),t("#part_aegis_num").on("change",function(t){r()}),t(".br-set-group").on("click","a",function(a){t(this).parents(".br-set-group").find("a").removeClass("active"),t(this).toggleClass("active")}),t(".j-input-place").on("focus",function(a){o(t(this))}),t(".j-input-place").on("blur",function(a){s(t(this))}),t(".j-input-place").on("keyup",function(a){i(t(this))}),t("#is_end_zhongjiang").on("change",function(a){t(this)[0].checked?t("#track_stop_money").removeAttr("disabled"):(t("#track_stop_money").attr("disabled","disabled"),t("#part_aegis_num").val(0))}),t("#j-touzhu-tips").on("click",function(a){if(t("#j-touzhu-tipstext").toggle(),t(this).find(".icon").toggleClass("icon-bup").toggleClass("icon-bdown"),t(this).find(".icon").hasClass("icon-bdown")){{var e=t(".j-navbar-wrapper").eq(1);e.height(),t("body").height(),t(window).height(),t(".ft").height()}e.css({top:"-200"})}})});