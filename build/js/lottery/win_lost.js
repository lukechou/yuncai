require.config({paths:{jquery:"../lib/jquery",lodash:"../lib/lodash.compat.min",bootstrap:"../lib/bootstrap.min",store:"../lib/store.min",app:"../common/app",core:"../lib/core"},shim:{bootstrap:{deps:["jquery"],exports:"jquery"}}}),require(["jquery","lodash","app","store","bootstrap","core"],function(t,a,e,n){"use strict";function o(a){t.trim(a.val())==a.attr("data-text")&&(a.parents("p").find(".j-btext-total").html(0),a.val(""))}function s(a){var e=a.attr("data-text");""==t.trim(a.val())&&(a.val(e),a.parents("p").find(".j-btext-total").html(e.length))}function i(t){var a=t.val().length,e=parseInt(t.attr("data-size"));e>=a?t.parents("p").find(".j-btext-total").html(a):(t.val(t.val().slice(0,e-1)),t.parents("p").find(".j-btext-total").html(e))}function r(){var a=u.money,e=t("#share-num").val()||a,n="",o="",s=t("#part_buy").val(),i="",r=1*t("#commission_percent").val()||0,c="",h="",p=parseInt(t("#part_aegis_num").val())||0,d=t("#has_part_aegis")[0].checked||!1;return e=Number(e.replace(/[^0-9]/g,"")),s=Number(s.replace(/[^0-9]/g,"")),0>=a?void l(0,r,0,0,0,0,0):(a%e===0?n=a/e:(n=1,e=a),0>=s&&(s=1),s>e&&(s=e),r>s/e*100&&(s=Math.ceil(e*r*.01)),o=s*n,t("#has_part_aegis")[0]&&(d=t("#has_part_aegis")[0].checked),d?(t("#part_aegis_num")[0].disabled=!1,c=0===p?.8>s/e?Math.ceil(.2*e):e-s:e>p+s?.2>p/e?Math.ceil(.2*e)+s>e?e-s:Math.ceil(.2*e):p:e-s,h=(c/e*100).toFixed(2)):(t("#part_aegis_num")[0].disabled=!0,c=0,h="0.00"),i=0===a?0:(s/e*100).toFixed(2),void l(e,n,s,r,i,h,c))}function l(a,e,n,o,s,i,r){var l={},c=r*e||0,u=(n+r)*e||0;0===a&&(e=0),l.shareNum=a,l.partBuyNum=n,l.unitPrice=e,l.commissionPercent=parseInt(t("#commission_percent").val()),l.partAegisNum=r,t("#share-num").val(a),t(".j-unit-price").html(e),t("#part_buy").val(n),t("#part_buy_percent").html(s),t("#part_aegis_num").val(r),t("#part_aegis_percent").html(i),t("#buy_money_tips").html(n*e),t("#aegis_money_tips").html(c),t("#total_money_tips").html(u)}var c=function(){function n(t){return this instanceof n?void 0:new n(t)}return n.prototype={isAgreen:!0,match:[],group:null,zhus:0,money:0,beishu:1,uniqMatch:[],payMoney:0,lotyCNName:"胜负彩"},n.prototype.init=function(){this.bindEvent()},n.prototype.getCodes=function(t,a){for(var e=null,n="",o=[],s=[],i=[3,1,0],r=0;r<t.length;r++){o=[],e=a[t[r]];for(var l=0;l<e.length;l++)o.push(i[e[l].index]);s.push(o.join(","))}return n=s.join("|")},n.prototype.getSubmitParams=function(){var t=this,a=null,e=[],n=null,o=null;o=t.group;for(var s in o)o.hasOwnProperty(s)&&e.push(s);return n=t.getCodes(e,o),a={zhushu:t.zhus,beishu:t.beishu,matchKeys:e.join(","),content:n}},n.prototype.bindEvent=function(){function n(){var e='<table class="touzhu-table"><tr class="grey-bg"><td>场次</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td><td>13</td><td>14</td></tr><tr class="h-100"><td>主队</td>',n='</tr><tr class="grey-bg"><td colspan="15" class="fc-3d">VS</td></tr><tr class="h-100"><td>客队</td>',s='</tr><tr class="grey-bg"><td>投注</td>',i="</tr></table>",r="",l="",c="",u=[],h="";return t(".j-data-dl dd").each(function(e,n){var s=t(this),i=t(this).attr("matchcode");l+='<td class="fc-3d">'+s.find(".j-maind").text()+"</td>",c+='<td class="fc-3d">'+s.find(".j-ked").text()+"</td>",u=a.map(o.group[i],function(t){var a=[3,1,0];return a[t.index]}),r+='<td class="fc-3d">'+u.join(" ")+"</td>"}),h=e+l+n+c+s+r+i}var o=this;t("#j-touzhu-tips").on("click",function(a){if(t("#j-touzhu-tipstext").toggle(),t(this).find(".icon").toggleClass("icon-bup").toggleClass("icon-bdown"),t(this).find(".icon").hasClass("icon-bdown")){{var e=t(".j-navbar-wrapper").eq(1);e.height(),t("body").height(),t(window).height(),t(".ft").height()}e.css({top:"-200"})}}),t(".j-data-dl .co7,.j-data-dl .co8,.j-data-dl .co9").click(function(e){var n="",s="",i=0,r=t(this),l=r.attr("index"),c=r.attr("sp"),u=r.attr("data-item"),h=r.attr("gametype"),p=r.parents("dd");r.toggleClass("active"),r.hasClass("active")?o.addOneItem(l,p,c,u,h):o.removeOneItem(l,p),o.group=a.groupBy(o.match,function(t){return t.matchcode}),o.uniqMatch=a.uniq(o.match,"matchcode"),14==o.uniqMatch.length?(o.zhus=o.getTotalZhus(),o.money=2*o.zhus,t(".j-gameZhu").text(o.zhus),t("#j-totalMoney").text(o.money)):o.uniqMatch.length<14&&(o.zhus=0,o.money=0,t(".j-gameZhu").text(o.zhus),t("#j-totalMoney").text(o.money)),t(".j-data-dl dd").each(function(a,e){var o=t(this),r=o.find(".co7"),l=o.find(".co8"),c=o.find(".co9"),u=r.hasClass("active"),h=l.hasClass("active"),p=c.hasClass("active"),d="",m="",g="";u&&(d=r.text()),h&&(m=l.text()),p&&(g=c.text()),(u||h||p)&&i++,7>a&&(n+='<li class="t2">'+d+m+g+"</li>"),a>=7&&(s+='<li class="t2">'+d+m+g+"</li>")}),n='<li class="t1">投注</li>'+n,s='<li class="t1">投注</li>'+s,t(".j-m-lscontent1").html(""),t(".j-m-lscontent1").html(n),t(".j-m-lscontent2").html(""),t(".j-m-lscontent2").html(s),t(".j-gameNumber").text(i),o.updateMoney()}),t("#j-btn-clear").click(function(a){t(".dataBody").find("span").removeClass("active"),t(".j-m-lscontent1").html('<li class="t1">投注</li>'),t(".j-m-lscontent2").html('<li class="t1">投注</li>'),o.match=[],o.group=null,o.zhus=0,o.money=0,o.beishu=1,t(".j-gameNumber").text("0"),t(".j-gameZhu").text(o.zhus),t(".j-quick-bei").val(o.beishu),t("#j-totalMoney").text(o.money)}),t(".j-coutn-total").on("click",".j-count",function(a){{var e=t(this).siblings(".btn-results"),n=t(this).attr("data-c");e.attr("data-r")}o.updateCount(e,n),o.updateMoney()}),t("#orderRule").on("click",".icon",function(a){var e=t(this);e.toggleClass("icon-cbox").toggleClass("icon-cgou"),o.isAgreen=e.hasClass("icon-cgou")}),t(".j-quick-bei").on("change",function(a){var e=t(this).val(),n=o.filterNum(e,99999);t(this).val(n),o.beishu=n,o.updateMoney()}),t(".j-quick-bei").on("keyup",function(a){var e=t(this).val(),n=o.filterNum(e,99999);t(this).val(n),o.updateMoney()}),t("#j-ljtzBtn").on("click",function(t){if(o.uniqMatch.length<14)return void e.showTips("请对14场比赛的赛过进行竞猜，每场比赛至少竞猜一个赛果");var a=o.getSubmitParams(),s='<div class="ljtz-info"><p>投注金额：总计<strong class="fc-3"> '+o.money+" </strong>元，共<strong> "+o.zhus+" </strong>注，投注<strong> "+o.beishu+" </strong>倍</p></div>",i="";i=n(),o.payMoney=o.money,o.buyLoty(function(){e.showTips({type:2,text:i+s,title:"投注信息确认",className:"touzhuinfo-modal",onConfirm:function(){alert(1)}})},a)}),t("#j-hemai").on("click",function(a){a.preventDefault();var e=BET.getSubmitParams();e.shareNum=t("#ballModal .j-share-num").val(),e.buyNum=Number(t("#ballModal .j-rengou").val()),e.aegisNum=Number(t("#ballModal .j-baodi-text").val()),e.tichengPercent=t("#ipt_extraPercent").val(),e.shareLevel=t("#ballModal .br-set.active").attr("data-set"),e.projectTitle=t("#ballModal .j-project-title").val(),e.projectText=t("#ballModal .br-textarea").val(),Config.payMoney=2*e.zhushu*e.beishu/e.shareNum*(e.buyNum+e.aegisNum),o.buyLoty(function(){t("#hemaiModal").modal("hide")},params,!0)}),t("#j-fqhmBtn").on("click",function(a){if(o.uniqMatch.length<14)return void e.showTips("请对14场比赛的赛过进行竞猜，每场比赛至少竞猜一个赛果");var s=o.getSubmitParams(),i=('<div class="fqhm-info"><p>投注金额：总计<strong class="fc-3"> '+o.money+" </strong>元，共<strong> "+o.zhus+" </strong>注，投注<strong> "+o.beishu+" </strong>倍</p></div>","");i=n(),t("#j-modal-table").html(i),o.payMoney=1,o.buyLoty(function(){t("#hemaiModal").modal("show"),r()},s)})},n.prototype.buyLoty=function(t,a,n){var o=this,s="";s+="<p>"+o.lotyCNName+"</p>",n?(s+='<p>方案总金额<span class="fc-3 mlr5">'+a.zhushu*a.beishu*2+".00</span>元</p>",s+='<p>您认购<span class="fc-3 mlr5">'+a.buyNum+'</span>份, 保底<span class="fc-3 mlr5">'+a.aegisNum+"</span>份</p>"):s+='<p>共<span class="fc-3 mlr5">'+a.zhushu+'</span>注，<span class="fc-3 mlr5">'+a.beishu+"</span>倍",s+='<p>本次需支付：<span class="fc-3 mlr5">'+o.payMoney+".00</span>元",e.checkLogin(o.payMoney,{enoughMoney:t,lessMoneyTips:s})},n.prototype.updateCount=function(t,a){var e=parseInt(t.val(),10);1==a?e++:e--,e=e>=1?e:1,e=e>99999?99999:e,this.beishu=e,t.val(e)},n.prototype.filterNum=function(t,a){if(""===t)return t;var e=parseInt(t,10);return isNaN(e)?e=1:(e=e>=1?e:1,e=e),e=e>a?a:e},n.prototype.addOneItem=function(t,a,e,n,o){var s=a.attr("matchcode");this.match.push({index:t,type:o,matchcode:s,sp:e,title:n})},n.prototype.removeOneItem=function(t,e){var n=this,o=e.attr("matchcode");a.remove(n.match,function(a){return a.index==t&&a.matchcode==o})},n.prototype.getTotalZhus=function(){for(var t=this.uniqMatch,a=this,e=1,n=0;14>n;n++)e*=a.group[t[n].matchcode].length;return e},n.prototype.updateMoney=function(){var a=t(".j-quick-bei"),e=parseInt(a.val(),10);this.money=2*this.zhus*e,t("#j-totalMoney").text(this.money)},n}(),u=new c;u.init(),t("#share-num").on("change",function(t){r()}),t("#part_buy").on("change",function(t){r()}),t("#commission_percent").on("change",function(a){var e=parseInt(t(this).val())||0,n=Math.floor(t("#part_buy_percent").html());e>n&&(t("#part_buy").val(Math.ceil(t("#commission_percent").val()/100*(t("#share-num").val()||0))),r())}),t("#has_part_aegis").on("change",function(a){t(this)[0].checked?t("#part_aegis_num").removeAttr("disabled"):(t("#part_aegis_num").attr("disabled","disabled"),t("#part_aegis_num").val(0),t("#part_aegis_percent").html("0.00")),r()}),t("#part_aegis_num").on("change",function(t){r()}),t(".br-set-group").on("click","a",function(a){t(this).parents(".br-set-group").find("a").removeClass("active"),t(this).toggleClass("active")}),t(".j-input-place").on("focus",function(a){o(t(this))}),t(".j-input-place").on("blur",function(a){s(t(this))}),t(".j-input-place").on("keyup",function(a){i(t(this))}),t("#is_end_zhongjiang").on("change",function(a){t(this)[0].checked?t("#track_stop_money").removeAttr("disabled"):(t("#track_stop_money").attr("disabled","disabled"),t("#part_aegis_num").val(0))})});